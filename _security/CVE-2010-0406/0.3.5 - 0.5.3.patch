---
layout: security_patch
cve: CVE-2010-0406
first_version: 0.3.5
last_version: 0.5.3
---

Index: network_server.c
===================================================================
--- network_server.c	(revision 19694)
+++ network_server.c	(revision 19695)
@@ -322,4 +322,4 @@

-	static FILE *file_pointer;
+	static FILE *file_pointer = NULL;
 	static uint sent_packets; // How many packets we did send succecfully last time

@@ -338,6 +338,9 @@
 		if (SaveOrLoad(filename, SL_SAVE, AUTOSAVE_DIR) != SL_OK) usererror("network savedump failed");

+		if (file_pointer != NULL) fclose(file_pointer);
+
 		file_pointer = fopen(filename, "rb");
+		if (file_pointer == NULL) error("network savedump failed - could not open just saved dump");
+
 		fseek(file_pointer, 0, SEEK_END);
-
 		if (ftell(file_pointer) == 0) usererror("network savedump failed - zero sized savegame?");
@@ -382,6 +385,7 @@
 				 *  to send it is ready (maybe that happens like never ;)) */
 				cs->status = STATUS_DONE_MAP;
 				fclose(file_pointer);
+				file_pointer = NULL;

 				NetworkClientSocket *new_cs;
 				bool new_map_client = false;
